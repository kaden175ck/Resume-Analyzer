# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

An AI-powered Resume Analyzer built with React Router v7 and Puter.js. The app provides browser-based authentication, file storage, and AI-powered resume analysis using Puter's serverless SDKâ€”no backend required.

## Development Commands

```bash
# Start development server
npm run dev

# Build for production
npm run build

# Start production server
npm start

# Type checking and type generation
npm run typecheck
```

## Tech Stack

- **React Router v7**: Framework with SSR enabled (configured in `react-router.config.ts`)
- **Puter.js**: Client-side SDK loaded via CDN (`https://js.puter.com/v2/`) in `app/root.tsx`
- **Zustand**: State management (see `app/lib/puter.ts`)
- **Tailwind CSS v4**: Styling with Vite plugin
- **TypeScript**: Strict mode enabled with path aliases (`~/` maps to `app/`)
- **Vite**: Build tool with `tsconfigPaths` plugin

## Architecture

### Puter.js Integration (`app/lib/puter.ts`)

Central Zustand store (`usePuterStore`) that wraps the global `window.puter` object. This is the **only way** to interact with Puter.js in the app.

**Key modules:**

- **auth**: Browser-based authentication
  - `signIn()`, `signOut()`, `checkAuthStatus()`, `refreshUser()`
  - Stores `user` and `isAuthenticated` state

- **fs**: File system operations
  - `write(path, data)`, `read(path)`, `upload(files)`, `delete(path)`, `readDir(path)`
  - Used for resume uploads and storage

- **ai**: AI operations
  - `chat(prompt, options)`: General AI chat (supports multi-modal with files)
  - `feedback(path, message)`: Resume analysis using Claude 3.7 Sonnet
  - `img2txt(image)`: OCR functionality

- **kv**: Key-value storage
  - `get(key)`, `set(key, value)`, `delete(key)`, `list(pattern)`, `flush()`

**Important patterns:**

- The store handles Puter.js initialization via `init()` which polls for `window.puter` availability (10s timeout)
- All methods check for Puter availability via `getPuter()` helper
- Error handling sets global `error` state and clears auth on failures
- Always access Puter through the store hooks, never directly via `window.puter`

### Type Definitions

- **`types/index.d.ts`**: Core app types (`Resume`, `Feedback`)
- **`types/puter.d.ts`**: Puter SDK types (`PuterUser`, `FSItem`, `AIResponse`, `ChatMessage`, etc.)
- **`app/lib/puter.ts`**: Global `window.puter` type augmentation

### Constants (`constants/index.ts`)

- **`resumes`**: Mock resume data array
- **`AIResponseFormat`**: Interface definition for AI feedback structure
- **`prepareInstructions(jobTitle, jobDescription)`**: Generates AI prompt for resume analysis

The AI expects responses in a structured format with:
- `overallScore` (0-100)
- Category scores: `ATS`, `toneAndStyle`, `content`, `structure`, `skills`
- Each category has a score and tips array with `type` ("good" | "improve"), `tip`, and `explanation`

### Routing (`app/routes.ts`)

- Uses React Router v7's file-based routing via `RouteConfig`
- Routes defined in `routes.ts`:
  - `index("routes/home.tsx")` - Home page with resume list
  - `route('/auth', 'routes/auth.tsx')` - Auth page

### Component Structure

- **`app/components/`**: Reusable UI components (Navbar, ResumeCard, ScoreCircle)
- **`app/root.tsx`**: Root layout with Puter.js CDN script injection
- **`app/routes/`**: Route components with type-safe loaders and meta functions

## Important Implementation Details

1. **Puter.js Loading**: The Puter CDN script is loaded in `app/root.tsx` via `<script src="https://js.puter.com/v2/"></script>`. The store's `init()` method must be called on app mount to ensure `window.puter` is available.

2. **Resume Analysis Flow**:
   - Upload resume via `usePuterStore().fs.upload()`
   - Call `usePuterStore().ai.feedback(resumePath, instructions)` where instructions are generated by `prepareInstructions()`
   - Parse JSON response matching `Feedback` interface structure

3. **SSR Considerations**: Puter.js is browser-only. Always check for `typeof window !== "undefined"` when accessing the store during SSR.

4. **Path Aliases**: Use `~/` prefix for app imports (e.g., `import Navbar from "~/components/Navbar"`)

5. **Type Generation**: Run `npm run typecheck` to generate React Router types in `.react-router/types/`
